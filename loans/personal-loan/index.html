<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Personal Loan Calculator ‚Äî EMI with Amortization</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../style.css" />
  <style>
    .amortization-section {
      margin-top: 20px;
      background: var(--surface);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(3,7,18,0.03);
    }
    .amortization-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .amortization-header h3 {
      margin: 0;
      font-size: 1.05rem;
      font-weight: 600;
    }
    .export-buttons {
      display: flex;
      gap: 8px;
    }
    .table-wrapper {
      max-height: 400px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid rgba(3,7,18,0.03);
    }
    .amortization-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.88rem;
    }
    .amortization-table thead {
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, #fff, #fbfdff);
      z-index: 10;
    }
    .amortization-table th {
      padding: 10px 8px;
      text-align: right;
      font-weight: 600;
      color: var(--muted);
      border-bottom: 2px solid rgba(3,7,18,0.06);
    }
    .amortization-table th:first-child {
      text-align: left;
    }
    .amortization-table td {
      padding: 8px;
      text-align: right;
      border-bottom: 1px solid rgba(3,7,18,0.03);
      color: var(--accent-strong);
    }
    .amortization-table td:first-child {
      text-align: left;
      font-weight: 600;
    }
    .amortization-table tbody tr:hover {
      background: rgba(59,130,246,0.02);
    }
    .year-row {
      background: linear-gradient(90deg,rgba(14,165,164,0.08),rgba(59,130,246,0.08)) !important;
      font-weight: 600;
    }
    .btn-export {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 8px;
      background: linear-gradient(90deg, #10b981, #059669);
      color: white;
      border: none;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(16,185,129,0.2);
    }
    .btn-export:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16,185,129,0.3);
    }
    .btn-export.secondary {
      background: linear-gradient(90deg, #3b82f6, #2563eb);
      box-shadow: 0 4px 12px rgba(59,130,246,0.2);
    }
    .btn-export.secondary:hover {
      box-shadow: 0 6px 16px rgba(59,130,246,0.3);
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
      padding: 14px;
      background: linear-gradient(180deg, #fff, #fbfdff);
      border-radius: 10px;
      border: 1px solid rgba(3,7,18,0.03);
    }
    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .summary-label {
      color: var(--muted);
      font-size: 0.88rem;
    }
    .summary-value {
      font-weight: 700;
      color: var(--accent-strong);
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <main class="site">
    <header class="header">
      <div class="brand">
        <svg class="mark" viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="grad" x1="0" x2="1">
              <stop offset="0" stop-color="#0ea5a4" />
              <stop offset="1" stop-color="#3b82f6" />
            </linearGradient>
          </defs>
          <rect x="2" y="4" width="20" height="16" rx="4" fill="url(#grad)"></rect>
          <path d="M7 14l3-5 4 6 3-4" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
        <div>
          <h1>Personal Loan Calculator</h1>
          <p class="tag">EMI calculator with detailed amortization</p>
        </div>
      </div>
      <a href="../../index.html" class="back-btn">Back to Home</a>
    </header>

    <section class="content">
      <form id="calcForm" class="panel" onsubmit="return false;">
        <h2>Loan Details</h2>

        <label class="field">
          <span class="label">Loan Amount (‚Çπ)</span>
          <input id="loanAmount" type="number" step="10000" value="500000" required />
        </label>

        <label class="field">
          <span class="label">Interest Rate (% per annum)</span>
          <input id="interestRate" type="number" step="0.1" value="12" required />
        </label>

        <label class="field">
          <span class="label">Loan Tenure (years)</span>
          <input id="tenure" type="number" step="0.5" min="0.5" max="10" value="5" required />
        </label>

        <label class="field">
          <span class="label">Processing Fee (% of loan amount)</span>
          <input id="processingFee" type="number" step="0.1" value="2" />
        </label>

        <div class="actions">
          <button id="calculateBtn" class="btn primary" type="button">Calculate EMI</button>
          <button id="resetBtn" class="btn ghost" type="button">Reset</button>
        </div>
      </form>

      <aside class="result" id="results">
        <h2 class="panel-title">Loan Summary</h2>

        <div class="cards">
          <div class="card">
            <div class="card-title">Monthly EMI</div>
            <div class="card-value" id="emiAmount">‚Äî</div>
            <div class="card-note">Principal + Interest per month</div>
          </div>

          <div class="card">
            <div class="card-title">Total Interest</div>
            <div class="card-value" id="totalInterest">‚Äî</div>
            <div class="card-note">Interest payable over tenure</div>
          </div>

          <div class="card">
            <div class="card-title">Total Payment</div>
            <div class="card-value" id="totalPayment">‚Äî</div>
            <div class="card-note">Loan + Interest + Fees</div>
          </div>
        </div>

        <div class="summary-grid" id="summaryGrid" style="display:none">
          <div class="summary-item">
            <span class="summary-label">Processing Fee</span>
            <span class="summary-value" id="feeAmount">‚Äî</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Net Loan Amount</span>
            <span class="summary-value" id="netLoan">‚Äî</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Total Months</span>
            <span class="summary-value" id="totalMonths">‚Äî</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Effective Rate</span>
            <span class="summary-value" id="effectiveRate">‚Äî</span>
          </div>
        </div>

        <div class="chart-container">
          <canvas id="loanChart"></canvas>
        </div>
      </aside>
    </section>

    <!-- Amortization Schedule -->
    <section class="amortization-section" id="amortizationSection" style="display:none">
      <div class="amortization-header">
        <h3>Amortization Schedule</h3>
        <div class="export-buttons">
          <button id="exportPdfBtn" class="btn-export">üìÑ Export PDF</button>
          <button id="printBtn" class="btn-export secondary">üñ®Ô∏è Print</button>
        </div>
      </div>
      
      <div class="table-wrapper">
        <table class="amortization-table" id="scheduleTable">
          <thead>
            <tr>
              <th>Month</th>
              <th>EMI</th>
              <th>Principal</th>
              <th>Interest</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody id="scheduleBody"></tbody>
        </table>
      </div>
    </section>

    <footer class="footer">
      <small>Built by destiny-tracer ‚Äî runs entirely in your browser, no data leaves your device.</small>
    </footer>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script>
(function(){
  const $ = id => document.getElementById(id);
  let chartInstance = null;
  let scheduleData = [];

  function fmtNumber(n){
    if (typeof n !== 'number' || !isFinite(n)) return '‚Äî';
    return '‚Çπ' + n.toLocaleString('en-IN', {minimumFractionDigits:0, maximumFractionDigits:0});
  }

  function calculate(){
    const principal = parseFloat($('loanAmount').value) || 0;
    const annualRate = parseFloat($('interestRate').value) || 0;
    const years = parseFloat($('tenure').value) || 0;
    const feePct = parseFloat($('processingFee').value) || 0;

    if (principal <= 0 || annualRate <= 0 || years <= 0){
      alert('Please enter valid values for all fields.');
      return;
    }

    const monthlyRate = annualRate / 12 / 100;
    const months = Math.round(years * 12);

    // EMI Formula
    const emi = principal * monthlyRate * Math.pow(1 + monthlyRate, months) / 
                (Math.pow(1 + monthlyRate, months) - 1);

    let balance = principal;
    let totalInterest = 0;
    scheduleData = [];

    // Generate amortization schedule
    for (let i = 1; i <= months; i++){
      const interestPaid = balance * monthlyRate;
      const principalPaid = emi - interestPaid;
      balance -= principalPaid;
      totalInterest += interestPaid;

      scheduleData.push({
        month: i,
        emi: emi,
        principal: principalPaid,
        interest: interestPaid,
        balance: Math.max(0, balance)
      });

      if (balance <= 0) break;
    }

    const processingFee = principal * (feePct / 100);
    const netLoan = principal - processingFee;
    const totalPayment = principal + totalInterest + processingFee;

    $('emiAmount').textContent = fmtNumber(emi);
    $('totalInterest').textContent = fmtNumber(totalInterest);
    $('totalPayment').textContent = fmtNumber(totalPayment);
    $('feeAmount').textContent = fmtNumber(processingFee);
    $('netLoan').textContent = fmtNumber(netLoan);
    $('totalMonths').textContent = months;
    $('effectiveRate').textContent = annualRate.toFixed(2) + '%';

    $('summaryGrid').style.display = 'grid';
    drawChart(principal, totalInterest, processingFee);
    generateSchedule(scheduleData);
    $('amortizationSection').style.display = 'block';
  }

  function drawChart(principal, interest, fee){
    const ctx = $('loanChart').getContext('2d');
    
    if (chartInstance) chartInstance.destroy();

    chartInstance = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Principal', 'Interest', 'Processing Fee'],
        datasets: [{
          data: [principal, interest, fee],
          backgroundColor: ['#0ea5a4', '#f59e0b', '#ef4444'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 16,
              font: {size: 13, family: 'Inter'}
            }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.label + ': ‚Çπ' + context.parsed.toLocaleString('en-IN');
              }
            }
          }
        }
      }
    });
  }

  function generateSchedule(data){
    const tbody = $('scheduleBody');
    tbody.innerHTML = '';
    
    data.forEach((row, idx) => {
      const isYearEnd = row.month % 12 === 0;
      const className = isYearEnd ? 'year-row' : '';
      
      tbody.innerHTML += `<tr class="${className}">
        <td>Month ${row.month}${isYearEnd ? ' (Year ' + (row.month/12) + ')' : ''}</td>
        <td>${fmtNumber(row.emi)}</td>
        <td>${fmtNumber(row.principal)}</td>
        <td>${fmtNumber(row.interest)}</td>
        <td>${fmtNumber(row.balance)}</td>
      </tr>`;
    });
  }

  function exportPDF(){
    if (scheduleData.length === 0){
      alert('Please calculate EMI first.');
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Title
    doc.setFontSize(18);
    doc.setTextColor(5, 32, 71);
    doc.text('Personal Loan Amortization Schedule', 14, 20);

    // Loan details
    doc.setFontSize(11);
    doc.setTextColor(107, 114, 128);
    const loanAmt = $('loanAmount').value;
    const rate = $('interestRate').value;
    const tenure = $('tenure').value;
    const emi = $('emiAmount').textContent;
    const totalInt = $('totalInterest').textContent;
    
    doc.text(`Loan Amount: ‚Çπ${parseFloat(loanAmt).toLocaleString('en-IN')}`, 14, 30);
    doc.text(`Interest Rate: ${rate}% p.a.`, 14, 36);
    doc.text(`Tenure: ${tenure} years`, 14, 42);
    doc.text(`Monthly EMI: ${emi}`, 110, 30);
    doc.text(`Total Interest: ${totalInt}`, 110, 36);

    // Table data
    const tableData = scheduleData.map(row => [
      `Month ${row.month}`,
      fmtNumber(row.emi),
      fmtNumber(row.principal),
      fmtNumber(row.interest),
      fmtNumber(row.balance)
    ]);

    doc.autoTable({
      head: [['Month', 'EMI', 'Principal', 'Interest', 'Balance']],
      body: tableData,
      startY: 50,
      styles: { fontSize: 8, cellPadding: 2 },
      headStyles: { fillColor: [14, 165, 164], textColor: 255 },
      alternateRowStyles: { fillColor: [246, 251, 255] },
      margin: { top: 50 }
    });

    // Footer
    const pageCount = doc.internal.getNumberOfPages();
    for(let i = 1; i <= pageCount; i++) {
      doc.setPage(i);
      doc.setFontSize(8);
      doc.setTextColor(150);
      doc.text(
        `Page ${i} of ${pageCount} | Generated by destiny-tracer`,
        doc.internal.pageSize.getWidth() / 2,
        doc.internal.pageSize.getHeight() - 10,
        { align: 'center' }
      );
    }

    doc.save('personal-loan-amortization.pdf');
  }

  function printSchedule(){
    if (scheduleData.length === 0){
      alert('Please calculate EMI first.');
      return;
    }
    window.print();
  }

  function reset(){
    $('calcForm').reset();
    $('emiAmount').textContent = '‚Äî';
    $('totalInterest').textContent = '‚Äî';
    $('totalPayment').textContent = '‚Äî';
    $('summaryGrid').style.display = 'none';
    $('amortizationSection').style.display = 'none';
    scheduleData = [];
    if (chartInstance) {
      chartInstance.destroy();
      chartInstance = null;
    }
  }

  $('calculateBtn').addEventListener('click', calculate);
  $('resetBtn').addEventListener('click', reset);
  $('exportPdfBtn').addEventListener('click', exportPDF);
  $('printBtn').addEventListener('click', printSchedule);
})();
  </script>
</body>
</html>
